From 1dbca2eccad58d91a5fd33962854f1a653638182 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Daniel=20P=2E=20Berrang=C3=A9?= <berrange@redhat.com>
Date: Mon, 21 May 2018 23:05:07 +0100
Subject: [PATCH] cpu: define the 'ssbd' CPUID feature bit (CVE-2018-3639)
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

New microcode introduces the "Speculative Store Bypass Disable"
CPUID feature bit. This needs to be exposed to guest OS to allow
them to protect against CVE-2018-3639.

Signed-off-by: Daniel P. Berrang√© <berrange@redhat.com>
Reviewed-by: Jiri Denemark <jdenemar@redhat.com>

Upstream-Status: Backport
This is not a vulnerability with libvirt, it just passes on the cpu flags
CVE: CVE-2018-3639
Signed-off-by: Armin Kuster <akuster@mvista.com>

---
 src/cpu/cpu_map.xml | 3 +++
 1 file changed, 3 insertions(+)

Index: libvirt-1.3.5/src/cpu/cpu_map.xml
===================================================================
--- libvirt-1.3.5.orig/src/cpu/cpu_map.xml
+++ libvirt-1.3.5/src/cpu/cpu_map.xml
@@ -287,6 +287,9 @@
     <feature name='perfctr_nb'>
       <cpuid function='0x80000001' ecx='0x01000000'/>
     </feature>
+    <feature name='ssbd'>
+      <cpuid eax_in='0x07' ecx_in='0x00' edx='0x80000000'/>
+    </feature>
 
     <!-- cpuid function 0x7 ecx 0x0 features -->
     <!-- We support only ecx 0x0 now as it's done by a workaround -->
